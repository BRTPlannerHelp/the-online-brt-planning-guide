{
	"prepare" : {
		"dockerfile" : {
			"type" : "path",
			"data" : ".robrt.Dockerfile"
		}
	},
	"build" : {
		"cmds" : [
			"cd $ROBRT_REPOSITORY_DIR",
			"git remote add lfs https://github.com/jonasmalacofilho/the-online-brt-planning-guide-with-lfs.git",
			"git fetch lfs",
			"git merge lfs/figures-with-lfs",
			"git lfs pull",

			"cd $ROBRT_REPOSITORY_DIR/generator",
			"haxe -D travis build.hxml",
			"nodejs bin/tests.js",

			"cd $ROBRT_REPOSITORY_DIR",
			"mkdir -p $ROBRT_OUTPUT_DIR/bin",
			"cp generator/bin/{obrt.n,obrt.js} $ROBRT_OUTPUT_DIR/bin/",
			"cp -r generator/docs/design/web/mockup $ROBRT_OUTPUT_DIR/web-mockup",

			"export DEBUG=1",

			"command time -v neko generator/bin/obrt.n gen guide/the-brt-planning-guide.src",

			"cp -r guide/the-brt-planning-guide.src.html $ROBRT_OUTPUT_DIR/guide",

			"nodejs --version",
			"command time -v nodejs generator/bin/obrt.js gen guide/the-brt-planning-guide.src",

			"cd guide/the-brt-planning-guide.src.pdf/",
			"mkdir -p $ROBRT_OUTPUT_DIR/pdf",

			"latexmk -xelatex -pdflatex='xelatex -interaction=nonstopmode' book.tex",
			"cp book.pdf $ROBRT_OUTPUT_DIR/pdf/guide_xelatex.pdf",
			"cp book.log $ROBRT_OUTPUT_DIR/pdf/guide_xelatex.log",
			"latexmk -C book.tex",

			"latexmk -lualatex -pdflatex='lualatex -interaction=nonstopmode' book.tex",
			"cp book.pdf $ROBRT_OUTPUT_DIR/pdf/guide_lualatex.pdf",
			"cp book.log $ROBRT_OUTPUT_DIR/pdf/guide_lualatex.log",
			"latexmk -C book.tex",

			"latexmk -pdf -pdflatex='pdflatex -interaction=nonstopmode' book.tex",
			"cp book.pdf $ROBRT_OUTPUT_DIR/pdf/guide_pdflatex.pdf",
			"cp book.log $ROBRT_OUTPUT_DIR/pdf/guide_pdflatex.log",
			"latexmk -C book.tex"
		]
	}
}

